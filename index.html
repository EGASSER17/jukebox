<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mon Jukebox</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #1a0a00; color: #f0e0c0; font-family: 'Georgia', serif; min-height: 100vh; }
  .machine { max-width: 480px; margin: 0 auto; background: linear-gradient(180deg,#8B1A00 0%,#5C1100 40%,#3a0a00 100%); min-height: 100vh; border-left: 6px solid #c8860a; border-right: 6px solid #c8860a; box-shadow: 0 0 40px #c8860a55; display: flex; flex-direction: column; }
  .header { background: linear-gradient(90deg,#c8860a,#f5c842,#c8860a); padding: 14px; text-align: center; border-bottom: 4px solid #8B1A00; }
  .header h1 { font-size: 1.6rem; color: #1a0a00; text-shadow: 1px 1px 0 #f5c842; letter-spacing: 3px; text-transform: uppercase; }
  .header p { font-size: .65rem; color: #3a0a00; letter-spacing: 2px; margin-top: 2px; }
  .screen { background: #0a1a0a; margin: 12px 16px; border-radius: 8px; border: 3px solid #c8860a; padding: 12px; box-shadow: inset 0 0 20px #00000088; }
  .now-playing-label { font-size: .6rem; color: #c8860a; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 4px; }
  .now-playing-title { font-size: 1rem; color: #7fff7f; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .now-playing-artist { font-size: .8rem; color: #aaffaa; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .progress-bar { background: #1a3a1a; border-radius: 4px; height: 5px; margin-top: 8px; overflow: hidden; cursor: pointer; }
  .progress-fill { background: #7fff7f; height: 100%; width: 0%; transition: width 1s linear; }
  #yt-player { display: none; }
  .controls { display: flex; justify-content: center; gap: 12px; margin: 6px 16px; }
  .ctrl-btn { background: #c8860a; border: none; border-radius: 50%; width: 42px; height: 42px; font-size: 1.1rem; cursor: pointer; color: #1a0a00; transition: background .15s; box-shadow: 0 3px 8px #00000066; }
  .ctrl-btn:hover { background: #f5c842; }
  .section { margin: 0 16px 10px; }
  .section-label { font-size: .6rem; color: #c8860a; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 6px; }
  .search-row { display: flex; gap: 8px; }
  .search-input { flex: 1; background: #0a1a0a; border: 2px solid #c8860a; border-radius: 6px; color: #f0e0c0; padding: 7px 10px; font-size: .8rem; outline: none; }
  .search-input::placeholder { color: #555; }
  .search-btn { background: #c8860a; border: none; border-radius: 6px; color: #1a0a00; padding: 7px 12px; font-size: .9rem; cursor: pointer; }
  .search-btn:hover { background: #f5c842; }
  .albums-section { flex: 1; margin: 0 16px; overflow: hidden; display: flex; flex-direction: column; min-height: 0; }
  .albums-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; overflow-y: auto; flex: 1; padding-bottom: 10px; }
  .albums-grid::-webkit-scrollbar { width: 4px; }
  .albums-grid::-webkit-scrollbar-thumb { background: #c8860a; border-radius: 2px; }
  .album-card { cursor: pointer; border-radius: 6px; overflow: hidden; border: 2px solid transparent; transition: border .15s, transform .15s; position: relative; }
  .album-card:hover { border-color: #f5c842; transform: scale(1.04); }
  .album-card.selected { border-color: #7fff7f; }
  .album-card.playing { border-color: #1DB954; }
  .album-card img { width: 100%; aspect-ratio: 1; display: block; object-fit: cover; background: #333; }
  .album-name { font-size: .58rem; text-align: center; padding: 2px; background: #1a0a00; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .album-artist { font-size: .52rem; text-align: center; padding: 0 2px 2px; background: #1a0a00; color: #c8860a; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .remove-btn { position: absolute; top: 2px; right: 2px; background: #8B1A00cc; border: none; border-radius: 50%; width: 18px; height: 18px; color: #f5c842; font-size: .65rem; cursor: pointer; display: none; align-items: center; justify-content: center; line-height: 1; }
  .album-card:hover .remove-btn { display: flex; }
  .tracks-panel, .search-results { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; background: #1a0a00; border-top: 3px solid #c8860a; border-left: 6px solid #c8860a; border-right: 6px solid #c8860a; max-height: 60vh; overflow-y: auto; z-index: 100; display: none; padding-bottom: 10px; }
  .tracks-panel.open, .search-results.open { display: block; }
  .search-results { z-index: 101; }
  .panel-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 16px; background: #3a0a00; position: sticky; top: 0; }
  .panel-header h3 { font-size: .85rem; color: #f5c842; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .close-btn { background: none; border: none; color: #c8860a; font-size: 1.3rem; cursor: pointer; }
  .track-item, .result-item { display: flex; align-items: center; gap: 10px; padding: 9px 16px; border-bottom: 1px solid #3a0a0044; transition: background .1s; cursor: pointer; }
  .track-item:hover, .result-item:hover { background: #3a0a00; }
  .track-item.playing { background: #0a3a0a; }
  .track-num { font-size: .7rem; color: #c8860a; min-width: 20px; text-align: right; }
  .track-info, .result-info { flex: 1; overflow: hidden; }
  .track-title, .result-title { font-size: .82rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .result-sub { font-size: .68rem; color: #c8860a; }
  .result-img { width: 44px; height: 44px; border-radius: 4px; object-fit: cover; flex-shrink: 0; background: #333; }
  .action-btn { background: #c8860a; border: none; border-radius: 4px; padding: 4px 8px; font-size: .68rem; color: #1a0a00; cursor: pointer; font-weight: bold; margin-left: 3px; flex-shrink: 0; }
  .action-btn:hover { background: #f5c842; }
  .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #1DB954; color: white; padding: 9px 18px; border-radius: 20px; font-size: .82rem; opacity: 0; transition: opacity .3s; z-index: 300; white-space: nowrap; pointer-events: none; }
  .toast.show { opacity: 1; }
  .loading-bar { background: #3a0a00; margin: 0 16px 8px; border-radius: 4px; height: 4px; overflow: hidden; display: none; }
  .loading-fill { background: #c8860a; height: 100%; width: 0%; transition: width .3s; }
</style>
</head>
<body>
<div id="yt-player"></div>
<div class="machine">
  <div class="header">
    <h1>üéµ Jukebox</h1>
    <p>Mix Soir√©e Early</p>
  </div>

  <div class="screen">
    <div class="now-playing-label">‚ñ∂ En cours</div>
    <div class="now-playing-title" id="trackTitle">‚Äî</div>
    <div class="now-playing-artist" id="trackArtist">‚Äî</div>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  </div>

  <div class="controls">
    <button class="ctrl-btn" onclick="prevTrack()">‚èÆ</button>
    <button class="ctrl-btn" id="playBtn" onclick="togglePlay()">‚ñ∂</button>
    <button class="ctrl-btn" onclick="nextTrack()">‚è≠</button>
    <button class="ctrl-btn" id="shuffleBtn" onclick="toggleShuffle()">üîÄ</button>
  </div>

  <div class="loading-bar" id="loadingBar">
    <div class="loading-fill" id="loadingFill"></div>
  </div>

  <div class="section">
    <div class="search-row">
      <input class="search-input" id="searchInput" placeholder="Ajouter un titre..." onkeydown="if(event.key==='Enter') search()" />
      <button class="search-btn" onclick="search()">üîç</button>
    </div>
  </div>

  <div class="albums-section">
    <div class="section-label">Albums (<span id="albumCount">0</span>)</div>
    <div class="albums-grid" id="albumsGrid">
      <div style="grid-column:1/-1;text-align:center;color:#c8860a;font-size:.8rem;padding:20px;">Chargement de ta playlist... üéµ</div>
    </div>
  </div>
</div>

<div class="tracks-panel" id="tracksPanel">
  <div class="panel-header">
    <h3 id="panelTitle">Titres</h3>
    <button class="close-btn" onclick="closeTracks()">‚úï</button>
  </div>
  <div id="tracksList"></div>
</div>

<div class="search-results" id="searchResults">
  <div class="panel-header">
    <h3>R√©sultats</h3>
    <button class="close-btn" onclick="closeSearch()">‚úï</button>
  </div>
  <div id="resultsList"></div>
</div>

<div class="toast" id="toast"></div>

<script>
const YT_KEY = 'AIzaSyAWXE17MurvNcrGZMKH1d-X6aY6IF3Z_lw';

// Playlist data ‚Äî grouped by album
const PLAYLIST = [
  {album:"The Beatles (Remastered)", artist:"The Beatles", tracks:["While My Guitar Gently Weeps","A Day In The Life"]},
  {album:"Electric Warrior", artist:"T. Rex", tracks:["Hot Love"]},
  {album:"Grace", artist:"Jeff Buckley", tracks:["Lover, You Should've Come Over"]},
  {album:"Ziggy Stardust", artist:"David Bowie", tracks:["Starman"]},
  {album:"Justified", artist:"Justin Timberlake", tracks:["Cry Me a River"]},
  {album:"Homework", artist:"Daft Punk", tracks:["Around the World"]},
  {album:"Pablo Honey", artist:"Radiohead", tracks:["Creep"]},
  {album:"The Wild Hunt", artist:"The Tallest Man On Earth", tracks:["The Wild Hunt"]},
  {album:"Breakfast in America", artist:"Supertramp", tracks:["Goodbye Stranger"]},
  {album:"Different Class", artist:"Pulp", tracks:["Common People"]},
  {album:"Wolfgang Amadeus Phoenix", artist:"Phoenix", tracks:["1901"]},
  {album:"Pet Sounds", artist:"The Beach Boys", tracks:["God Only Knows"]},
  {album:"Crosby Stills & Nash", artist:"Crosby, Stills & Nash", tracks:["Suite: Judy Blue Eyes"]},
  {album:"Business Casual", artist:"Chromeo", tracks:["Night By Night"]},
  {album:"Random Access Memories", artist:"Daft Punk", tracks:["Give Life Back to Music"]},
  {album:"Unplugged", artist:"Eric Clapton", tracks:["Tears In Heaven"]},
  {album:"Pink Moon", artist:"Nick Drake", tracks:["Pink Moon"]},
  {album:"The Freewheelin' Bob Dylan", artist:"Bob Dylan", tracks:["Don't Think Twice, It's All Right"]},
  {album:"Led Zeppelin III", artist:"Led Zeppelin", tracks:["That's the Way","Going to California"]},
  {album:"The Singles Collection", artist:"The Kinks", tracks:["Victoria"]},
  {album:"Rumours", artist:"Fleetwood Mac", tracks:["Don't Stop"]},
  {album:"Wish You Were Here", artist:"Pink Floyd", tracks:["Wish You Were Here"]},
  {album:"Brothers In Arms", artist:"Dire Straits", tracks:["Sultans Of Swing","Money For Nothing"]},
  {album:"OK Computer", artist:"Radiohead", tracks:["No Surprises"]},
  {album:"x", artist:"Ed Sheeran", tracks:["I See Fire"]},
  {album:"21", artist:"Adele", tracks:["Someone Like You"]},
  {album:"Otis Blue", artist:"Otis Redding", tracks:["I've Been Loving You Too Long"]},
  {album:"Songs In The Key Of Life", artist:"Stevie Wonder", tracks:["Pastime Paradise"]},
  {album:"Mud Slide Slim", artist:"James Taylor", tracks:["You've Got a Friend"]},
  {album:"McCartney", artist:"Paul McCartney", tracks:["Junk"]},
  {album:"The Stranger", artist:"Billy Joel", tracks:["Vienna"]},
  {album:"The Collection", artist:"Simon & Garfunkel", tracks:["Bleecker Street"]},
  {album:"Tea For The Tillerman", artist:"Cat Stevens", tracks:["Father And Son"]},
  {album:"Let It Be", artist:"The Beatles", tracks:["Get Back"]},
  {album:"Hunky Dory", artist:"David Bowie", tracks:["Life on Mars?"]},
  {album:"Legend", artist:"Bob Marley & The Wailers", tracks:["Could You Be Loved"]},
  {album:"The Essential Bruce Springsteen", artist:"Bruce Springsteen", tracks:["The River"]},
  {album:"Play", artist:"Moby", tracks:["Everloving"]},
  {album:"Imagine", artist:"John Lennon", tracks:["Jealous Guy"]},
  {album:"A Night At The Opera", artist:"Queen", tracks:["Love Of My Life"]},
  {album:"Goodbye Yellow Brick Road", artist:"Elton John", tracks:["Goodbye Yellow Brick Road"]},
  {album:"The Marshall Mathers LP", artist:"Eminem", tracks:["The Real Slim Shady"]},
  {album:"My Beautiful Dark Twisted Fantasy", artist:"Kanye West", tracks:["Runaway"]},
  {album:"Graceland", artist:"Paul Simon", tracks:["Graceland"]},
  {album:"Greatest Hits", artist:"The Cure", tracks:["Lullaby"]},
  {album:"Reflektor", artist:"Arcade Fire", tracks:["Reflektor"]},
  {album:"A Rush of Blood to the Head", artist:"Coldplay", tracks:["The Scientist"]},
  {album:"Nevermind", artist:"Nirvana", tracks:["Lithium"]},
  {album:"Night Train", artist:"Oscar Peterson Trio", tracks:["Georgia On My Mind"]},
  {album:"L.A. Woman", artist:"The Doors", tracks:["Riders on the Storm"]},
  {album:"Justice", artist:"Justice", tracks:["D.A.N.C.E."]},
  {album:"The Nat King Cole Story", artist:"Nat King Cole", tracks:["Smile"]},
  {album:"Supernatural", artist:"Santana", tracks:["Maria Maria"]},
  {album:"O", artist:"Damien Rice", tracks:["The Blower's Daughter"]},
  {album:"Just Enough Education To Perform", artist:"Stereophonics", tracks:["Have A Nice Day"]},
  {album:"The Libertines", artist:"The Libertines", tracks:["What Katie Did"]},
  {album:"Mellon Collie", artist:"The Smashing Pumpkins", tracks:["1979"]},
  {album:"The Score", artist:"Fugees", tracks:["Ready or Not"]},
  {album:"The Miseducation of Lauryn Hill", artist:"Ms. Lauryn Hill", tracks:["Doo Wop (That Thing)"]},
  {album:"Either/Or", artist:"Elliott Smith", tracks:["Angeles"]},
  {album:"Say It Ain't So", artist:"Murray Head", tracks:["Never Even Thought"]},
  {album:"Purple Rain", artist:"Prince", tracks:["When Doves Cry"]},
  {album:"The K√∂ln Concert", artist:"Keith Jarrett", tracks:["K√∂ln January 24 1975"]},
  {album:"Greatest Hits", artist:"Neil Young", tracks:["Down By The River"]},
  {album:"The Joshua Tree", artist:"U2", tracks:["Where The Streets Have No Name"]},
  {album:"London Calling", artist:"The Clash", tracks:["London Calling"]},
  {album:"The Velvet Underground & Nico", artist:"The Velvet Underground", tracks:["I'm Waiting For The Man"]},
  {album:"Are You Experienced", artist:"Jimi Hendrix", tracks:["Purple Haze"]},
  {album:"Back To Black", artist:"Amy Winehouse", tracks:["Back To Black"]},
  {album:"Back In Black", artist:"AC/DC", tracks:["Back In Black"]},
  {album:"Parallel Lines", artist:"Blondie", tracks:["Heart Of Glass"]},
  {album:"Origin of Symmetry", artist:"Muse", tracks:["Plug in Baby"]},
  {album:"Out Of Time", artist:"R.E.M.", tracks:["Losing My Religion"]},
  {album:"Sea Change", artist:"Beck", tracks:["Lost Cause"]},
  {album:"AM", artist:"Arctic Monkeys", tracks:["Do I Wanna Know?"]},
  {album:"Lost In The Dream", artist:"The War On Drugs", tracks:["Red Eyes"]},
  {album:"Forty Licks", artist:"The Rolling Stones", tracks:["Jumpin' Jack Flash"]},
  {album:"Is This It", artist:"The Strokes", tracks:["Is This It"]},
  {album:"Arrival", artist:"ABBA", tracks:["Dancing Queen"]},
  {album:"Parachutes", artist:"Coldplay", tracks:["Yellow"]},
  {album:"(What's the Story) Morning Glory?", artist:"Oasis", tracks:["Don't Look Back in Anger"]},
  {album:"Jagged Little Pill", artist:"Alanis Morissette", tracks:["Ironic"]},
  {album:"Little Neon Limelight", artist:"Houndmouth", tracks:["Sedona"]},
  {album:"Je Dis Aime", artist:"-M-", tracks:["Je dis aime"]},
  {album:"Platinum Charles Aznavour", artist:"Charles Aznavour", tracks:["La boh√®me"]},
  {album:"Samedi soir sur la terre", artist:"Francis Cabrel", tracks:["La corrida"]},
  {album:"After Hours", artist:"The Weeknd", tracks:["Save Your Tears"]},
  {album:"1989 (Taylor's Version)", artist:"Taylor Swift", tracks:["Shake It Off"]},
  {album:"Stars", artist:"The Cranberries", tracks:["Linger"]},
  {album:"HIStory", artist:"Michael Jackson", tracks:["Thriller"]},
  {album:"Hurry Up We're Dreaming", artist:"M83", tracks:["Wait"]},
  {album:"Oracular Spectacular", artist:"MGMT", tracks:["Electric Feel"]},
  {album:"The Bodyguard", artist:"Whitney Houston", tracks:["I Will Always Love You"]},
  {album:"Californication", artist:"Red Hot Chili Peppers", tracks:["Californication"]},
  {album:"The Immaculate Collection", artist:"Madonna", tracks:["Holiday"]},
  {album:"Starmania", artist:"France Gall", tracks:["Monopolis"]},
  {album:"Ladies And Gentlemen", artist:"George Michael", tracks:["Don't Let the Sun Go Down on Me"]},
  {album:"D'eux", artist:"C√©line Dion", tracks:["J'irai o√π tu iras"]},
];

let albums = [], ytPlayer = null, ytReady = false;
let currentIdx = -1, shuffleOn = false, progressInterval = null;

function showToast(msg, color='#1DB954') {
  const t = document.getElementById('toast');
  t.style.background = color;
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// YouTube
window.onYouTubeIframeAPIReady = () => {
  ytReady = true;
  ytPlayer = new YT.Player('yt-player', {
    height:'0', width:'0',
    playerVars: { autoplay: 0 },
    events: {
      onStateChange: e => {
        if (e.data === YT.PlayerState.ENDED) nextTrack();
        if (e.data === YT.PlayerState.PLAYING) { document.getElementById('playBtn').textContent = '‚è∏'; startProgress(); }
        if (e.data === YT.PlayerState.PAUSED) document.getElementById('playBtn').textContent = '‚ñ∂';
      }
    }
  });
};

function startProgress() {
  if (progressInterval) clearInterval(progressInterval);
  progressInterval = setInterval(() => {
    if (!ytPlayer?.getCurrentTime) return;
    const cur = ytPlayer.getCurrentTime(), dur = ytPlayer.getDuration();
    if (dur > 0) document.getElementById('progressFill').style.width = (cur/dur*100)+'%';
  }, 1000);
}

// Search YT for a query, return first videoId
async function ytSearch(q) {
  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(q)}&maxResults=1&key=${YT_KEY}`;
  const data = await fetch(url).then(r=>r.json());
  return data.items?.[0] ? { id: data.items[0].id.videoId, thumb: data.items[0].snippet.thumbnails.medium?.url || data.items[0].snippet.thumbnails.default?.url } : null;
}

// Load playlist by searching each album
async function loadPlaylist() {
  // Try localStorage first
  const saved = localStorage.getItem('jukebox_v2');
  if (saved) {
    try { albums = JSON.parse(saved); renderAlbums(); return; } catch(e) {}
  }

  const bar = document.getElementById('loadingBar');
  const fill = document.getElementById('loadingFill');
  bar.style.display = 'block';

  albums = [];
  for (let i = 0; i < PLAYLIST.length; i++) {
    const p = PLAYLIST[i];
    fill.style.width = ((i+1)/PLAYLIST.length*100)+'%';
    const q = `${p.tracks[0]} ${p.artist} official`;
    const res = await ytSearch(q);
    if (res) {
      albums.push({ id: res.id, name: p.album, artist: p.artist, img: res.thumb, tracks: p.tracks.map(t => ({ id: res.id, name: t })) });
    }
    // Small delay to avoid quota
    await new Promise(r => setTimeout(r, 100));
  }
  
  bar.style.display = 'none';
  localStorage.setItem('jukebox_v2', JSON.stringify(albums));
  renderAlbums();
  showToast(`${albums.length} albums charg√©s !`);
}

function renderAlbums() {
  document.getElementById('albumCount').textContent = albums.length;
  const grid = document.getElementById('albumsGrid');
  if (!albums.length) { grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#555;padding:20px;">Aucun album</div>'; return; }
  grid.innerHTML = albums.map((a,i) => `
    <div class="album-card ${currentIdx===i?'playing':''}" id="alb_${i}" onclick="playAlbum(${i})">
      <button class="remove-btn" onclick="removeAlbum(${i},event)">‚úï</button>
      <img src="${a.img||''}" alt="${a.name}" loading="lazy" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22><rect fill=%22%23333%22 width=%22100%22 height=%22100%22/><text fill=%22%23666%22 font-size=%2230%22 x=%2250%22 y=%2255%22 text-anchor=%22middle%22>üéµ</text></svg>'">
      <div class="album-name">${a.name}</div>
      <div class="album-artist">${a.artist}</div>
    </div>`).join('');
}

function playAlbum(idx) {
  currentIdx = idx;
  const a = albums[idx];
  document.getElementById('trackTitle').textContent = a.tracks[0].name;
  document.getElementById('trackArtist').textContent = a.artist;
  document.querySelectorAll('.album-card').forEach((c,i) => { c.classList.toggle('playing', i===idx); });
  if (ytReady && ytPlayer) { ytPlayer.loadVideoById(a.id); ytPlayer.playVideo(); }
  closeTracks(); closeSearch();
}

function removeAlbum(idx, e) {
  e.stopPropagation();
  albums.splice(idx, 1);
  localStorage.setItem('jukebox_v2', JSON.stringify(albums));
  if (currentIdx === idx) currentIdx = -1;
  else if (currentIdx > idx) currentIdx--;
  renderAlbums();
}

function togglePlay() {
  if (!ytPlayer || !ytReady) return;
  ytPlayer.getPlayerState() === YT.PlayerState.PLAYING ? ytPlayer.pauseVideo() : ytPlayer.playVideo();
}

function nextTrack() {
  if (!albums.length) return;
  currentIdx = shuffleOn ? Math.floor(Math.random()*albums.length) : (currentIdx+1)%albums.length;
  playAlbum(currentIdx);
}

function prevTrack() {
  if (!albums.length) return;
  currentIdx = (currentIdx-1+albums.length)%albums.length;
  playAlbum(currentIdx);
}

function toggleShuffle() {
  shuffleOn = !shuffleOn;
  document.getElementById('shuffleBtn').style.background = shuffleOn ? '#1DB954' : '#c8860a';
  showToast(shuffleOn ? 'Al√©atoire activ√©' : 'Al√©atoire d√©sactiv√©');
}

async function search() {
  const q = document.getElementById('searchInput').value.trim();
  if (!q) return;
  showToast('Recherche...');
  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(q)}&maxResults=8&key=${YT_KEY}`;
  const data = await fetch(url).then(r=>r.json());
  if (!data.items?.length) { showToast('Aucun r√©sultat', '#c0392b'); return; }
  document.getElementById('resultsList').innerHTML = data.items.map(item => `
    <div class="result-item">
      <img class="result-img" src="${item.snippet.thumbnails.default.url}" alt="">
      <div class="result-info">
        <div class="result-title">${item.snippet.title}</div>
        <div class="result-sub">${item.snippet.channelTitle}</div>
      </div>
      <button class="action-btn" onclick="addVideo('${item.id.videoId}','${item.snippet.title.replace(/'/g,"\\'")}','${item.snippet.channelTitle.replace(/'/g,"\\'")}','${(item.snippet.thumbnails.medium?.url||item.snippet.thumbnails.default.url).replace(/'/g,"\\'")}')">+ Ajouter</button>
    </div>`).join('');
  document.getElementById('searchResults').classList.add('open');
}

function addVideo(id, title, channel, thumb) {
  if (albums.find(a => a.id === id)) { showToast('D√©j√† dans le jukebox !', '#c8860a'); return; }
  albums.push({ id, name: title, artist: channel, img: thumb, tracks: [{ id, name: title }] });
  localStorage.setItem('jukebox_v2', JSON.stringify(albums));
  renderAlbums();
  showToast('Ajout√© !');
}

function closeTracks() { document.getElementById('tracksPanel').classList.remove('open'); }
function closeSearch() { document.getElementById('searchResults').classList.remove('open'); }

// Load YouTube API
const tag = document.createElement('script');
tag.src = 'https://www.youtube.com/iframe_api';
document.head.appendChild(tag);

// Start
loadPlaylist();
</script>
</body>
</html>
